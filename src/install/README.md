---
order: 4
dir:
    text: "2. Установка"
    order: 2
    link: true
index: true
---

[[toc]]

# Установка

Stormbpmn поставляется как Docker-контейнер из приватного репозитория, который включает в себя frontend и backend. Установка заключается в правильном указании переменных окружения, развертывании смежных контейнеров (при необходимости) и настройке в административном интерфейсе.

::: tip Доступ к репозиторию
Контейнер расположен в приватном репозитории. Запросите доступ через менеджера, с которым работаете.
Актуальная версия контейнера указана в разделе Changelog этой документации.
:::


::: tip 2 этапа установки
В меню слева расписаны 2 этапа "Быстрый старт" и "Production-ready". Их нужно выполнить последовательно, пропускать нельзя.
:::


::: warning Использование корпоративных сервисов
**Рекомендация:** Если в вашей организации есть централизованные сервисы инфраструктуры, используйте именно их:

-   **DBaaS** (Database as a Service) вместо самостоятельного развертывания PostgreSQL
-   **S3aaS** или корпоративное файловое хранилище вместо MinIO
-   **Managed SMTP** вместо собственного почтового сервера
-   **Corporate SSO/SAML** вместо Keycloak
-   **Централизованный мониторинг** (Prometheus/Grafana) вместо локального

Это упростит развертывание, обеспечит лучшую поддержку и соответствие корпоративным стандартам безопасности.
:::

## Системные требования

### Общие минимальные требования для всей системы

| Компонент         | CPU         | RAM       | Диск       | Примечание                 |
| ----------------- | ----------- | --------- | ---------- | -------------------------- |
| **Общие ресурсы** | **12 vCPU** | **24 GB** | **300 GB** | Минимум для полной системы |
| **Рекомендуемые** | **16 vCPU** | **32 GB** | **500 GB** | Для стабильной работы      |
| **Production**    | **24 vCPU** | **32 GB** | **500 GB** | Для высокой нагрузки       |

### Требования по контейнерам

#### Основные компоненты (обязательные)

| Контейнер      | CPU    | RAM  | Диск   | Порты          | Описание               |
| -------------- | ------ | ---- | ------ | -------------- | ---------------------- |
| **StormBPMN**  | 4 vCPU | 8 GB | 20 GB  | 8080,8081,8082 | Основное приложение    |
| **PostgreSQL** | 2 vCPU | 4 GB | 100 GB | 5432           | База данных            |
| **Nginx**      | 1 vCPU | 1 GB | 5 GB   | 80, 443        | Балансировщик нагрузки |

#### Хранилище и файлы

| Контейнер | CPU    | RAM  | Диск   | Порты      | Описание                                 |
| --------- | ------ | ---- | ------ | ---------- | ---------------------------------------- |
| **MinIO** | 1 vCPU | 2 GB | 100 GB | 9000, 9001 | S3-совместимое хранилище (API + Console) |

#### Авторизация и безопасность

| Контейнер       | CPU      | RAM    | Диск  | Порты        | Описание            |
| --------------- | -------- | ------ | ----- | ------------ | ------------------- |
| **Keycloak**    | 2 vCPU   | 3 GB   | 10 GB | 8180         | Система авторизации |
| **SMTP Server** | 0.5 vCPU | 512 MB | 5 GB  | 25, 587, 465 | Почтовый сервер     |

#### Мониторинг (опционально)

| Контейнер      | CPU      | RAM  | Диск  | Порты | Описание            |
| -------------- | -------- | ---- | ----- | ----- | ------------------- |
| **Prometheus** | 1 vCPU   | 2 GB | 50 GB | 9090  | Сбор метрик         |
| **Grafana**    | 0.5 vCPU | 1 GB | 5 GB  | 3000  | Визуализация метрик |

#### Дополнительные сервисы (опционально)

| Контейнер     | CPU      | RAM  | Диск | Порты | Описание           |
| ------------- | -------- | ---- | ---- | ----- | ------------------ |
| **ListMonk**  | 0.5 vCPU | 1 GB | 5 GB | 9000  | Система рассылок   |
| **PlantUML**  | 0.5 vCPU | 1 GB | 2 GB | 8090  | Генерация диаграмм |
| **Gotenberg** | 1 vCPU   | 2 GB | 5 GB | 3001  | Конвертация в PDF  |

### Конфигурации развертывания

#### Минимальная конфигурация (для тестирования)

```yaml
# Только основные компоненты
StormBPMN + PostgreSQL + Nginx
Итого: 7 vCPU, 13 GB RAM, 125 GB диск
```

#### Базовая конфигурация (для работы)

```yaml
# Основные + авторизация + хранилище
StormBPMN + PostgreSQL + Nginx + MinIO + Keycloak + SMTP
Итого: 10.5 vCPU, 18.5 GB RAM, 240 GB диск
```

#### Корпоративная конфигурация (с централизованными сервисами)

```yaml
# Только StormBPMN + внешние корпоративные сервисы
StormBPMN + Nginx + интеграция с:
    - DBaaS (внешний PostgreSQL)
    - S3aaS (внешнее хранилище)
    - Corporate SSO (внешняя авторизация)
    - Managed SMTP (внешняя почта)

Итого: 5 vCPU, 9 GB RAM, 25 GB диск
```

#### Полная конфигурация (Production)

```yaml
# Все компоненты включая мониторинг
Все контейнеры из таблиц выше
Итого: 13 vCPU, 23.5 GB RAM, 307 GB диск
```

### Требования к операционной системе

#### Поддерживаемые ОС:

Любые, где работает докер, например (не ограничиваясь):
-   **Ubuntu**: 20.04 LTS, 22.04 LTS, 24.04 LTS
-   **CentOS**: 8+, Stream 9
-   **RHEL**: 8+, 9+
-   **Debian**: 11+, 12+
-   **Amazon Linux**: 2, 2023

#### Российские ОС:

-   **Astra Linux**: 1.7+, 1.8 (SE, CE)
-   **ALT Linux**: 10+, Simply Linux
-   **РЕД ОС**: 7.3+, 8
-   **ROSA Linux**: 12+
-   Любые другие российские ОС с поддержкой Docker или Podman

::: tip Импортозамещение контейнеризации
Для соответствия требованиям реестра отечественного ПО вместо Docker можно использовать **Podman** — OCI-совместимую альтернативу, входящую в реестр российского ПО. Подробнее см. раздел [Альтернативы Docker](#альтернативы-docker-импортозамещение).
:::

### Рекомендации по дискам

| Тип данных     | Рекомендуемый тип диска | Примечание                                |
| -------------- | ----------------------- | ----------------------------------------- |
| **PostgreSQL** | SSD                     | Критично для производительности           |
| **MinIO/S3**   | SSD или HDD             | Зависит от интенсивности работы с файлами |
| **Логи**       | HDD                     |                                           |
| **Приложения** | HDD                     |                                           |

### Сетевые требования

#### Пропускная способность:

-   **Минимум**: 100 Mbps
-   **Рекомендуемо**: 1 Gbps
-   **Production**: 10 Gbps (для высокой нагрузки)

#### Latency:

-   **Между компонентами**: < 1ms (в одной сети)
-   **До пользователей**: < 100ms
-   **До внешних API**: < 500ms

## Сетевые требования

### Обязательные порты

| Сервис         | Порт             | Протокол   | Назначение                    |
| -------------- | ---------------- | ---------- | ----------------------------- |
| **StormBPMN**  | 8080, 8081, 8082 | HTTP/HTTPS | Основное веб-приложение       |
| **PostgreSQL** | 5432             | TCP        | База данных                   |
| **Nginx**      | 80, 443          | HTTP/HTTPS | Балансировщик, SSL терминация |
| **MinIO**      | 9000, 9001       | HTTP/HTTPS | S3 API + веб-консоль          |

### Дополнительные порты (опционально)

| Сервис         | Порт         | Протокол   | Назначение          |
| -------------- | ------------ | ---------- | ------------------- |
| **Keycloak**   | 8180         | HTTP/HTTPS | Система авторизации |
| **SMTP**       | 25, 587, 465 | SMTP/SMTPS | Почтовый сервер     |
| **Prometheus** | 9090         | HTTP       | Сбор метрик         |
| **Grafana**    | 3000         | HTTP       | Визуализация метрик |
| **ListMonk**   | 9000         | HTTP       | Система рассылок    |
| **PlantUML**   | 8090         | HTTP       | Генерация диаграмм  |
| **Gotenberg**  | 3001         | HTTP       | Конвертация в PDF   |

### Внешние соединения

-   **SMTP сервер**: порт 587/465 (для уведомлений)
-   **LDAP/AD**: порт 389/636 (для аутентификации)
-   **Интернет**: для загрузки обновлений

## DNS имена и сертификаты

### Планирование DNS

#### Обязательные записи:

-   **stormbpmn.company.com** - основной домен приложения. Должен вести на 8081
-   **stormbpmn-api.company.com** - API endpoints (опционально). Должен вести на 8082

## Альтернативы Docker (импортозамещение)

StormBPMN поставляется как **OCI-совместимые контейнерные образы**, что позволяет использовать альтернативные инструменты контейнеризации вместо Docker.

### Podman (рекомендуется для импортозамещения)

**Podman** — полностью совместимая с Docker альтернатива, входящая в реестр российского ПО. Команды Podman идентичны командам Docker.

#### Установка на Astra Linux / ALT Linux / РЕД ОС

```bash
# Astra Linux 1.8
sudo apt install podman podman-compose

# ALT Linux
sudo apt-get install podman podman-compose

# РЕД ОС
sudo dnf install podman podman-compose
```

#### Использование

```bash
# Вместо docker используйте podman
podman pull cr.stormbpmn.com/stormbpmn:latest
podman run -d --name stormbpmn ...

# Вместо docker-compose используйте podman-compose
podman-compose up -d
```

::: tip Совместимость команд
Для удобства можно создать алиас: `alias docker=podman`
:::

### CRI-O (для Kubernetes)

При развёртывании в Kubernetes можно использовать **CRI-O** — легковесный container runtime, полностью совместимый с OCI-образами.

### Containerd

**Containerd** — низкоуровневый runtime, используемый в Kubernetes и совместимый со всеми OCI-образами StormBPMN.

::: warning Важно
Независимо от выбранного инструмента контейнеризации, OCI-образы StormBPMN работают одинаково. Все инструкции с `docker` в документации применимы к `podman` без изменений.
:::
