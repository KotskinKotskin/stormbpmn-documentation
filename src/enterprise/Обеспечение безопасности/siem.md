---
order: 3
index: true
---

# SIEM
Мы предоставляем возможность получать информацию о всех операциях, выполняемых авторизированными пользователями в отдельном хранилище. Сейчас поддерживается Syslog как транспорт, сообщите менеджерам, если вам требуется другой транспорт, например Kafka.

## Особенности
- SIEM-логирование работает только для авторизованных методов
- Мы маскируем авторизационные заголовки и пароли, их невозможно найти в логах.
- Мы не сохраняем большие элементы запросов (body диаграмм).

## Принцип работы
Каждый запрос-ответ от пользователя формирует следующий объект:
```
{
  "timestamp": "2007-12-03T10:15:30:55.000000", // Временная метка в таймзоне сервера
  "sessionId": "ergjieor-ergjniuo-qjwer", // Уникальный ID сессии пользователя 
  "forwarder": null, // Служебное поле
  "source": "stormbpmn", // Название нашего приложения. Может быть изменено в ENV переменной SYSLOG_SOURCE.
  "subject": "kotov@bpmn2.ru", // Почта пользователя, соверщающего запрос
  "subjectIP": "192.168.0.1", // IP-адрес пользователя. Проставляется при наличии заголовка X-Forwarded-For от прокси-сервера.
  "object": "uaerhgae-aerj3234-egerg", // ID объекта, над которым совершается операция
  "resourse": "diagram", // Тип объекта, над которым совершается операция. Список возможных значений: GET /api/v1/syslog/resources
  "ctp": null, // Служебное поле
  "action": "CHANGE" // Тип события. Возможные значения: [ GET, CREATE, CHANGE, DELETE ]
  "tags": [ 
    "storm",
    "users_audit",
    "iia",
    null,
    null
  ], // Служебные поля
  "payload": {
    "method": "POST", // Вызванный метод
    "url": "/api/v1/diagram", // Вызванный URL
    "request": { // Присланный запрос, уникальный объект для каждого URL
       ...
    },
    "response": { // Полученный ответ, уникальный объект для каждого URL
       ...
    }
  },
  "result": "SUCCESSFUL" // Статус ответа. Возможные значения: [ SUCCESSFUL, CLIENT_ERROR, SERVER_ERROR ]
}
```

## Настройка Syslog

Для включения SIEM-логирования в syslog необходимо установить следующие ENV-переменные:
| Название | Описание | Значение |
|:---:|:---:|:---:|
| AUDIT_ENABLED | Флаг включения аудита запросов | true |
| AUDIT_CHANNEL | Канал аудит логов | syslog |
| SYSLOG_SERVERS | Список syslog серверов для стриминга<br>(протокол TCP, формат сообщений [RFC 3164](https://datatracker.ietf.org/doc/html/rfc3164)) | localhost:514,192.168.78.53:601<br>(пример) |
| SYSLOG_SOURCE | Название приложения<br>(передается серверам и в поле source самого лога) | stormbpmn<br>(по умолчанию) |
